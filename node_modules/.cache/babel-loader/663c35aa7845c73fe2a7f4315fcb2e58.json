{"ast":null,"code":"/** \n * Copyright © INOVUA TRADING.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\nvar _react = require(\"react\");\nvar diff = function diff(a1, a2) {\n  if (a1.length != a2.length) {\n    return true;\n  }\n  for (var i = 0; i < a1.length; i++) {\n    if (!Object.is(a1[i], a2[i])) {\n      return true;\n    }\n  }\n  return false;\n};\nvar resolved = Promise.resolve(true);\nvar useLoadDataEffect = function useLoadDataEffect(_ref, fn, _ref2) {\n  var getDataSource = _ref.getDataSource;\n  var reloadDeps = _ref2.reloadDeps,\n    noReloadDeps = _ref2.noReloadDeps;\n  var prevComputedDepsRef = (0, _react.useRef)([]);\n  var reloadRef = (0, _react.useRef)();\n  var noReloadRef = (0, _react.useRef)();\n  var reloadDepsDifferent = !reloadRef.current || diff(reloadRef.current, reloadDeps);\n  var noReloadDepsDifferent = !noReloadRef.current || diff(noReloadRef.current, noReloadDeps);\n  var depsDifferent = reloadDepsDifferent || noReloadDepsDifferent;\n  var shouldReload = reloadDepsDifferent;\n  var shouldReloadRef = (0, _react.useRef)(false);\n  var computedDeps = depsDifferent ? [{}] : prevComputedDepsRef.current;\n  var resolveRef = (0, _react.useRef)(null);\n  var promiseRef = (0, _react.useRef)(resolved);\n  if (depsDifferent) {\n    shouldReloadRef.current = shouldReload;\n    promiseRef.current = new Promise(function (resolve) {\n      resolveRef.current = resolve;\n    });\n  }\n  var _useState = (0, _react.useState)(function () {\n      return new Set();\n    }),\n    _useState2 = (0, _slicedToArray2.default)(_useState, 1),\n    pendingSet = _useState2[0];\n  var intercept = (0, _react.useCallback)(function (promise, dataSource) {\n    var isRemote = typeof dataSource === 'function' || (dataSource === null || dataSource === void 0 ? void 0 : dataSource.then);\n    if (!isRemote) {}\n    pendingSet.clear();\n    pendingSet.add(promise);\n    return promise.then(function (r) {\n      if (pendingSet.has(promise)) {\n        pendingSet.delete(promise);\n        return r;\n      }\n      return Promise.reject({\n        message: \"This request is discarded as it was still pending when a new request came in.\",\n        result: r\n      });\n    });\n  }, []);\n  (0, _react.useLayoutEffect)(function () {\n    var reload = shouldReloadRef.current;\n    var dataSource = getDataSource({\n      shouldReload: reload\n    });\n    fn(dataSource, {\n      shouldReload: reload,\n      intercept: intercept\n    }).then(function () {\n      if (resolveRef.current) {\n        resolveRef.current();\n      }\n    });\n    shouldReloadRef.current = shouldReload;\n  }, computedDeps);\n  reloadRef.current = reloadDeps;\n  noReloadRef.current = noReloadDeps;\n  prevComputedDepsRef.current = computedDeps;\n  return promiseRef.current;\n};\nvar _default = useLoadDataEffect;\nexports.default = _default;","map":{"version":3,"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","_slicedToArray2","_react","diff","a1","a2","length","i","is","resolved","Promise","resolve","useLoadDataEffect","_ref","fn","_ref2","getDataSource","reloadDeps","noReloadDeps","prevComputedDepsRef","useRef","reloadRef","noReloadRef","reloadDepsDifferent","current","noReloadDepsDifferent","depsDifferent","shouldReload","shouldReloadRef","computedDeps","resolveRef","promiseRef","_useState","useState","Set","_useState2","pendingSet","intercept","useCallback","promise","dataSource","isRemote","then","clear","add","r","has","delete","reject","message","result","useLayoutEffect","reload","_default"],"sources":["/Users/alexandre.nepomuceno/Documents/agenda/node_modules/@inovua/reactdatagrid-community/hooks/useLoadDataEffect/index.js"],"sourcesContent":["/** \n * Copyright © INOVUA TRADING.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\nvar _react = require(\"react\");\nvar diff = function diff(a1, a2) {\n  if (a1.length != a2.length) {\n    return true;\n  }\n  for (var i = 0; i < a1.length; i++) {\n    if (!Object.is(a1[i], a2[i])) {\n      return true;\n    }\n  }\n  return false;\n};\nvar resolved = Promise.resolve(true);\nvar useLoadDataEffect = function useLoadDataEffect(_ref, fn, _ref2) {\n  var getDataSource = _ref.getDataSource;\n  var reloadDeps = _ref2.reloadDeps,\n    noReloadDeps = _ref2.noReloadDeps;\n  var prevComputedDepsRef = (0, _react.useRef)([]);\n  var reloadRef = (0, _react.useRef)();\n  var noReloadRef = (0, _react.useRef)();\n  var reloadDepsDifferent = !reloadRef.current || diff(reloadRef.current, reloadDeps);\n  var noReloadDepsDifferent = !noReloadRef.current || diff(noReloadRef.current, noReloadDeps);\n  var depsDifferent = reloadDepsDifferent || noReloadDepsDifferent;\n  var shouldReload = reloadDepsDifferent;\n  var shouldReloadRef = (0, _react.useRef)(false);\n  var computedDeps = depsDifferent ? [{}] : prevComputedDepsRef.current;\n  var resolveRef = (0, _react.useRef)(null);\n  var promiseRef = (0, _react.useRef)(resolved);\n  if (depsDifferent) {\n    shouldReloadRef.current = shouldReload;\n    promiseRef.current = new Promise(function (resolve) {\n      resolveRef.current = resolve;\n    });\n  }\n  var _useState = (0, _react.useState)(function () {\n      return new Set();\n    }),\n    _useState2 = (0, _slicedToArray2.default)(_useState, 1),\n    pendingSet = _useState2[0];\n  var intercept = (0, _react.useCallback)(function (promise, dataSource) {\n    var isRemote = typeof dataSource === 'function' || (dataSource === null || dataSource === void 0 ? void 0 : dataSource.then);\n    if (!isRemote) {}\n    pendingSet.clear();\n    pendingSet.add(promise);\n    return promise.then(function (r) {\n      if (pendingSet.has(promise)) {\n        pendingSet.delete(promise);\n        return r;\n      }\n      return Promise.reject({\n        message: \"This request is discarded as it was still pending when a new request came in.\",\n        result: r\n      });\n    });\n  }, []);\n  (0, _react.useLayoutEffect)(function () {\n    var reload = shouldReloadRef.current;\n    var dataSource = getDataSource({\n      shouldReload: reload\n    });\n    fn(dataSource, {\n      shouldReload: reload,\n      intercept: intercept\n    }).then(function () {\n      if (resolveRef.current) {\n        resolveRef.current();\n      }\n    });\n    shouldReloadRef.current = shouldReload;\n  }, computedDeps);\n  reloadRef.current = reloadDeps;\n  noReloadRef.current = noReloadDeps;\n  prevComputedDepsRef.current = computedDeps;\n  return promiseRef.current;\n};\nvar _default = useLoadDataEffect;\nexports.default = _default;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}